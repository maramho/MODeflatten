file /home/dongho.lee/MODeflattener/MODeflattener/ll_file/cfg.O0.flatten_binary
break main
run < input.txt

# ìŠ¤íƒ í¬ì¸í„° ì €ìž¥
set $base = $rsp
printf "âœ… [DEBUG] Stack base address: %p\n", $base

# ðŸ” ì£¼ìš” ë ˆì§€ìŠ¤í„° ì¶”ì  (RSP, RBP, RIP)
define debug_registers
    printf "ðŸ” RSP: %p | RBP: %p | RIP: %p\n", $rsp, $rbp, $rip
end

# ðŸ“ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§ (ê´‘ë²”ìœ„í•œ ì˜¤í”„ì…‹ íƒìƒ‰)
define watch_state
    set $i = 0
    set $offset = 0
    while ($i < 20)
        set $addr = $base + $offset
        printf "ðŸ“ [DEBUG] Monitoring address: %p | Offset: %d\n", $addr, $offset
        if ($addr != 0)
            printf "ðŸ” Value at %p: ", $addr
            x/wx $addr
        else
            printf "âŒ Invalid address detected.\n"
        end
        set $i = $i + 1
        set $offset = $offset + 4   # 4ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ í™•ì¸
    end
end

# main í•¨ìˆ˜ ì§„ìž… ì‹œ ì‹¤í–‰
commands
    silent
    printf "ðŸš€ Starting register debug...\n"
    debug_registers
    printf "ðŸš€ Starting state monitoring...\n"
    watch_state
    continue
end

# í”„ë¡œê·¸ëž¨ ì¢…ë£Œ ì§ì „ ìƒíƒœ í™•ì¸
define hookpost-main
    debug_registers
    watch_state
end

continue
